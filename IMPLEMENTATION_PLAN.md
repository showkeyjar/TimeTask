# TimeTask 自动化增强实施计划

## 目标
让 TimeTask 常驻桌面，"倾听"和"观察"用户需求，自动凝练为四象限任务，同时保持资源消耗低、不打扰用户工作。

## 实施原则
- 🚫 不弹窗打扰用户
- ✅ 静默采集，智能触发
- 💾 保护隐私，本地处理优先
- ⚡ 资源消耗最小化

## 实施阶段

### 阶段 1: 语音监听优化 (当前已有)
**目标**: 让现有语音监听更轻量、更安静

- [ ] 1.1 优化 AudioCaptureService - 降低资源消耗
  - [ ] 降低采样率从 44.1kHz → 16kHz (语音足够)
  - [ ] 改为只转文字，不保存音频文件
  - [ ] 使用更保守的 VAD 参数
- [ ] 1.2 添加语音意图识别
  - [ ] 本地离线 NLP 判断是否为"任务相关"内容
  - [ ] 只对任务相关内容调用 LLM
- [ ] 1.3 任务草稿机制
  - [ ] 后台凝练任务，存入草稿箱
  - [ ] 不立即弹窗提醒

### 阶段 2: 屏幕活动观察 (新增)
**目标**: 感知用户工作状态，在适当时机介入

- [ ] 2.1 屏幕活动监测服务
  - [ ] 监测当前活跃窗口 (进程名 + 标题)
  - [ ] 检测用户空闲状态
  - [ ] 低频采样 (每 30-60 秒)
- [ ] 2.2 状态推断
  - [ ] 推断"专注模式"vs"休息模式"
  - [ ] 记录工作上下文

### 阶段 3: 智能触发机制 (新增)
**目标**: 恰到好处的自动化提醒

- [ ] 3.1 触发策略
  - [ ] 任务草稿累积 > 3个 → Toast 通知
  - [ ] 用户持续工作 > 2小时 → 休息提醒
  - [ ] Ctrl+Space 快速添加面板
- [ ] 3.2 交互优化
  - [ ] 托盘图标状态指示
  - [ ] 系统通知集成

### 阶段 4: 隐私与配置 (新增)
**目标**: 用户可控、隐私安全

- [ ] 4.1 用户配置界面
  - [ ] 开关各采集功能
  - [ ] 调整敏感度
  - [ ] 查看/清空历史数据
- [ ] 4.2 隐私保护
  - [ ] 本地处理优先
  - [ ] 数据存储加密

## 技术架构

```
┌─────────────────────────────────────────────────────────┐
│                   TimeTask 主程序                       │
├─────────────────────────────────────────────────────────┤
│  采集层                                                 │
│  ├── AudioCaptureService (优化)                        │
│  └── ScreenActivityMonitor (新增)                      │
├─────────────────────────────────────────────────────────┤
│  处理层                                                 │
│  ├── IntentRecognizer (新增 - 本地意图识别)            │
│  ├── TaskDraftManager (新增 - 草稿管理)                │
│  └── LlmService (已有 - 智能凝练)                      │
├─────────────────────────────────────────────────────────┤
│  触发层                                                 │
│  ├── TriggerPolicyEngine (新增 - 触发策略)             │
│  └── NotificationManager (新增 - 通知管理)             │
└─────────────────────────────────────────────────────────┘
```

## 优先级排序

| 优先级 | 功能 | 风险 | 工作量 |
|--------|------|------|--------|
| P0 | 语音监听优化 | 低 | 中 |
| P0 | 任务草稿机制 | 低 | 小 |
| P1 | 屏幕活动监测 | 低 | 中 |
| P1 | 触发策略引擎 | 低 | 中 |
| P2 | 用户配置界面 | 低 | 大 |
| P2 | 隐私保护 | 低 | 中 |

## 启动检查
- [x] 项目可正常编译
- [x] 现有功能正常
- [x] 了解代码结构

---

## 实施日志

### 2026-02-09
- [x] 理解项目整体结构
- [x] 制定实施计划
- [x] 开始阶段1: 语音监听优化
  - [x] 创建 IntentRecognizer.cs - 本地意图识别
  - [x] 创建 TaskDraftManager.cs - 任务草稿管理
  - [x] 创建 EnhancedAudioCaptureService.cs - 增强型语音采集
  - [x] 创建 NotificationManager.cs - 静默通知系统
  - [x] 更新 App.xaml.cs - 集成新服务
  - [x] 更新 TimeTask.csproj - 添加新文件引用

### 待完成 (阶段1)
- [x] 创建草稿查看窗口 (DraftViewerWindow.xaml + .cs)
- [x] 在主窗口添加"查看草稿"按钮
- [x] 更新 AddTaskWindow 支持预填充
- [ ] 测试编译
