# TimeTask 更新日志

## 2026-02-09 - 阶段1: 语音监听优化

### 新增功能

#### 1. 智能语音监听服务 (EnhancedAudioCaptureService.cs)
- ✅ 降低采样率: 44.1kHz → 16kHz (语音足够用，降低资源消耗)
- ✅ 只转文字，不保存音频文件 (节省存储空间，保护隐私)
- ✅ 本地意图识别 (避免对每句话都调用 LLM)
- ✅ 自动任务草稿生成
- ✅ 保留原有 AudioCaptureService 作为备用

#### 2. 本地意图识别 (IntentRecognizer.cs)
- ✅ 基于关键词模式判断内容是否"任务相关"
- ✅ 排除非任务内容（闲聊、天气等）
- ✅ 快速估计任务优先级（High/Medium/Low）
- ✅ 清理识别文本（移除语气词、无关内容）

#### 3. 任务草稿管理 (TaskDraftManager.cs)
- ✅ 后台存储潜在任务草稿
- ✅ 自动去重（相似草稿合并）
- ✅ 过期清理（保留7天）
- ✅ JSON 格式持久化存储

#### 4. 静默通知系统 (NotificationManager.cs)
- ✅ 托盘图标状态指示
- ✅ Toast 通知（可忽略，不打断工作）
- ✅ 工作休息提醒（每2小时）
- ✅ 草稿累积到3个时触发通知

#### 5. 草稿查看窗口 (DraftViewerWindow.xaml/.cs)
- ✅ 列出所有未处理草稿
- ✅ 一键添加到四象限任务
- ✅ 快速忽略/清空草稿

### 用户体验改进

1. **不打扰用户**
   - 静默采集，智能触发
   - 托盘图标闪烁代替弹窗
   - 可忽略的 Toast 通知

2. **恰到好处的自动化**
   - 草稿累积到3个才通知
   - 工作2小时后提醒休息
   - 用户主动查看草稿

3. **隐私保护**
   - 不保存音频文件
   - 本地处理优先
   - 草稿存储在 AppData

### 代码变更

| 文件 | 变更类型 | 说明 |
|------|----------|------|
| App.xaml.cs | 修改 | 集成新服务 |
| TimeTask.csproj | 修改 | 添加新文件引用 |
| MainWindow.xaml | 修改 | 添加草稿按钮 |
| MainWindow.xaml.cs | 修改 | 添加事件处理器 |
| AddTaskWindow.xaml.cs | 修改 | 支持预填充任务 |
| EnhancedAudioCaptureService.cs | 新增 | 增强语音服务 |
| IntentRecognizer.cs | 新增 | 本地意图识别 |
| TaskDraftManager.cs | 新增 | 草稿管理 |
| NotificationManager.cs | 新增 | 通知管理 |
| DraftViewerWindow.xaml/.cs | 新增 | 草稿查看窗口 |

### 使用说明

1. **启动后自动运行**
   - 语音监听自动启动
   - 任务草稿自动生成
   - 托盘图标常驻

2. **查看草稿**
   - 点击托盘图标 → "查看任务草稿"
   - 或点击主窗口的 📋 按钮

3. **添加任务**
   - 在草稿窗口选择草稿
   - 点击"添加到任务"
   - 自动填充到对应象限

### 后续计划

- **阶段2**: 屏幕活动观察
- **阶段3**: 用户配置界面
- **阶段4**: 隐私保护增强
